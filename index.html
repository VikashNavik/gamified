<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DailyQuest ‚Äî Gamified Habit Tracker</title>
  <style>
    :root {
      --bg: #0f1220;
      --card: #171a2b;
      --muted: #8890a6;
      --text: #e7ebff;
      --accent: #6c8bff;
      --good: #3ddc97;
      --warn: #ffb020;
      --danger: #ff6b6b;
    }

    /* Light theme overrides when data-theme="light" on <html> */
   [data-theme="light"] {
  --bg: #ffffff;
  --card: #ffffff;
  --panel: #ffffff;

  --muted: #5b5b5b;
  --text: #000000;

  --accent: #3556ff;
  --good: #188a50;
  --warn: #b36f00;
  --danger: #b32b2b;

  /* Light mode borders & shadows */
  --border: #d9d9d9;
  --shadow: 0 4px 14px rgba(0,0,0,0.08);
}


    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .container { max-width: 1000px; margin: 0 auto; padding: 20px; }

    /* Header layout - changed to accommodate hamburger */
    header {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      position: relative;
    }

    .header-left {
      display:flex;
      align-items:center;
      gap:12px;
    }

    .title { font-weight: 800; letter-spacing: .5px; font-size: clamp(22px, 3vw, 34px); }
    .subtitle { color: var(--muted); font-size: 14px; }

    .hud { display: grid; gap: 12px; grid-template-columns: 1fr; flex: 1; }
    @media (min-width: 700px) { .hud { grid-template-columns: 1fr auto; } }

    .xpbar { background: #0a0d1a; border: 1px solid #2b3154; border-radius: 14px; padding: 10px 12px; box-shadow: 0 8px 30px rgba(0,0,0,.2) inset; }
    .xpbar-top { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); margin-bottom: 8px; }
    .bar {
      width: 100%; height: 12px; border-radius: 999px; background: #0d1228; overflow: hidden; outline: 1px solid #2b3154;
    }
    .bar > span { display: block; height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), #9aaaff); transition: width .35s ease; }

    .chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .chip { background: #111428; border: 1px solid #2b3154; padding: 6px 10px; border-radius: 999px; font-size: 12px; color: var(--muted); }

    .panel { background: #0f1430; border: 1px solid #2b3154; border-radius: 16px; padding: 14px; }

    form.add {
      display: grid; grid-template-columns: 70px 1fr 110px 120px; gap: 10px; align-items: center; margin-top: 8px;
    }
    @media (max-width: 640px) { form.add { grid-template-columns: 60px 1fr 110px; } .hidden-mobile { display: none; } }
    input, button, select, textarea {
      height: 40px; border-radius: 10px; border: 1px solid #2b3154; background: #0b0f24; color: var(--text);
      padding: 0 12px; font-size: 14px; outline: none;
    }
    input::placeholder { color: #7383aa; }
    input[type="color"] { padding: 0; }
    button { cursor: pointer; border: 1px solid #334083; background: linear-gradient(180deg, #1a2150, #111640); box-shadow: 0 6px 16px rgba(15, 30, 80, .35); }
    button:hover { filter: brightness(1.1); }

    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 12px; margin-top: 12px; }

    .card { position: relative; background: var(--card); border: 1px solid #2b3154; border-radius: 16px; padding: 14px; box-shadow: 0 10px 30px rgba(0,0,0,.25); overflow: hidden; }
    .card .top { display: flex; gap: 10px; align-items: center; justify-content: space-between; }
    .left { display: flex; align-items: center; gap: 10px; }
    .icon { width: 40px; height: 40px; border-radius: 12px; display: grid; place-items: center; font-size: 20px; background: #121737; border: 1px solid #2b3154; }
    .name { font-weight: 700; }
    .muted { color: var(--muted); font-size: 12px; }

    .streak { display: inline-flex; align-items: center; gap: 6px; background: #111428; border: 1px solid #2b3154; padding: 4px 8px; border-radius: 999px; font-size: 12px; color: var(--muted); }

    .complete {
      height: 38px; min-width: 110px; padding: 0 12px; border-radius: 10px; font-weight: 700; border: 1px solid #244e2b; background: linear-gradient(180deg, #0d2f16, #0a1f0f); color: #bdfad4;
    }
    .complete.done { border-color: #3950a3; background: linear-gradient(180deg, #13215a, #0c163d); color: #a4b8ff; }

    .footer { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 16px; }
    .ghost { background: #0b0f24; border: 1px dashed #334083; color: var(--muted); }

    .danger { background: linear-gradient(180deg, #3b0f0f, #250909); border-color: #7a1b1b; color: #ffb7b7; }
    .success { background: linear-gradient(180deg, #10341f, #0d2215); border-color: #235f37; color: #bdfad4; }

    .tiny { font-size: 11px; color: var(--muted); }
    .right { text-align: right; }

    .row { display: flex; justify-content: space-between; align-items: center; gap: 10px; }

    /* ------------------------------
       Sidebar & Hamburger styles
       ------------------------------ */
    .hamburger {
      width: 42px;
      height: 36px;
      display: inline-flex;
      flex-direction: column;
      justify-content: center;
      gap: 6px;
      padding: 6px;
      cursor: pointer;
      border-radius: 8px;
      background: transparent;
      border: 1px solid transparent;
      transition: all .18s ease;
    }
    .hamburger:hover { background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,0.03); }
    .hamburger .bar {
      display:block;
      height:3px;
      border-radius:3px;
      background: var(--text);
      width:22px;
      transition: transform .22s ease, opacity .18s ease;
    }
    /* transform when active */
    .hamburger.active .bar:nth-child(1) { transform: translateY(4px) rotate(45deg); }
    .hamburger.active .bar:nth-child(2) { opacity: 0; transform: scaleX(.1); }
    .hamburger.active .bar:nth-child(3) { transform: translateY(-4px) rotate(-45deg); }

    .side-menu {
      position: fixed;
      top: 0;
      left: -52%;
      width: 50%;
      max-width: 420px;
      height: 100%;
      background: linear-gradient(180deg,var(--card), rgba(17,18,32,0.98));
      border-right: 1px solid rgba(43,49,84,0.6);
      box-shadow: 10px 0 40px rgba(0,0,0,0.6);
      padding: 20px;
      z-index: 2200;
      transition: left .38s cubic-bezier(.2,.9,.2,1);
      display:flex;
      flex-direction:column;
    }
    .side-menu.open { left: 0; }

    /* overlay to dim content when menu open */
    .menu-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      z-index: 2100;
      opacity: 0;
      pointer-events: none;
      transition: opacity .3s ease;
    }
    .menu-overlay.show { opacity: 1; pointer-events: auto; }

    .profile {
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
      padding: 8px 0 18px;
      border-bottom: 1px solid rgba(255,255,255,0.03);
    }
    .profile img {
      width: 96px;
      height: 96px;
      border-radius: 999px;
      object-fit: cover;
      border: 3px solid rgba(255,255,255,0.06);
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
      cursor: pointer;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
    }
    .profile input[type="file"]{ display:none; }

    .username {
      font-size:18px;
      font-weight:700;
      color:var(--text);
      cursor: text;
      text-align:center;
    }
    .username-edit {
      display:none;
      width: 80%;
      padding:8px;
      border-radius:10px;
      border: 1px solid rgba(255,255,255,0.06);
      background: transparent;
      color: var(--text);
    }

    .menu-buttons {
      margin-top: 18px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      padding: 8px 0;
      flex:1;
    }
    .menu-btn {
      width:100%;
      text-align:left;
      padding: 12px 14px;
      border-radius: 12px;
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.03);
      color: var(--text);
      cursor: pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      transition: transform .12s ease, background .12s ease;
    }
    .menu-btn:hover { transform: translateY(-3px); background: rgba(255,255,255,0.03); }

    /* theme toggle inside menu btn */
    .toggle {
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .switch {
      width:48px;
      height:26px;
      background: #ffffff;
      border-radius: 30px;
      position:relative;
      border:2px solid #000;
      box-sizing: border-box;
      cursor:pointer;
    }
    .switch .knob {
      position:absolute;
      top:2px;
      left:3px;
      width:20px;
      height:20px;
      border-radius:50%;
      background:#000;
      transition: transform .22s ease, background .22s ease;
    }
    .switch.on { background:#000; border-color:#fff; }
    .switch.on .knob { transform: translateX(22px); background:#fff; }

    /* small helpers */
    .small-muted { color: var(--muted); font-size: 13px; }
    .menu-footer { margin-top:auto; padding-top:12px; border-top:1px solid rgba(255,255,255,0.02); display:flex; gap:8px; }

    @media (max-width:680px) {
      .side-menu { width: 82%; left: -86%; }
      .side-menu.open { left:0; }
    }

    /* Force ALL dark panels to turn white in light mode */
[data-theme="light"] .panel,
[data-theme="light"] .xpbar,
[data-theme="light"] .chip,
[data-theme="light"] .streak,
[data-theme="light"] .icon,
/* Keep card white, but do NOT override the custom border color */
[data-theme="light"] .card {
  background: #ffffff;
  box-shadow: var(--shadow);
  border-color: inherit;  /* allows custom color */
}

/* Inputs & buttons */
[data-theme="light"] input,
[data-theme="light"] select,
[data-theme="light"] textarea {
  background: #ffffff !important;
  border-color: var(--border) !important;
  color: #000 !important;
}

[data-theme="light"] button {
  background: #ffffff !important;
  border-color: var(--border) !important;
  color: #000 !important;
  box-shadow: var(--shadow) !important;
}

/* Sidebar */
[data-theme="light"] .side-menu {
  background: #ffffff !important;
  border-color: var(--border) !important;
  box-shadow: var(--shadow) !important;
}

/* Menu buttons */
[data-theme="light"] .menu-btn {
  background: #ffffff !important;
  border-color: var(--border) !important;
  color: #000 !important;
}

#grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr); /* Exactly 2 cards each row */
  gap: 20px;  /* Space between rows & columns */
  margin-top: 20px;
}
/* Mobile first: 1 card per row */
#grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
  margin-top: 20px;
}

/* Tablet: 2 cards per row */
@media(min-width: 481px) and (max-width: 899px) {
  #grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* changes needed here for 1 slide or 2 */


</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-left">
        <!-- Hamburger next to title (Option B) -->
        <button id="hamburgerBtn" class="hamburger" aria-label="Open menu" title="Menu">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </button>

        <div>
          <div class="title">DailyQuest <span class="tiny">‚Äî Gamified Habit Tracker</span></div>
        </div>
      </div>

      <div class="hud" style="flex:1; margin-left:12px;">
        <div style="display:flex; gap:12px; align-items:center;">
          <div class="xpbar" style="flex:1;">
            <div class="xpbar-top">
              <div>Level <b id="level">1</b></div>
              <div><span id="xp">0</span> XP ‚Ä¢ Next level in <span id="toNext">100</span> XP</div>
            </div>
            <div class="bar"><span id="xpFill"></span></div>
            <div class="chips" id="badges"></div>
          </div>

          <div class="right" style="display:flex; gap:8px; align-items:center;">
            <button id="exportBtn" class="ghost">Export backup</button>
            <label for="importFile" class="ghost" style="display:inline-grid;place-items:center;padding:0 12px;height:40px;border-radius:10px;cursor:pointer;">Import backup</label>
            <input id="importFile" type="file" accept="application/json" style="display:none" />
          </div>
        </div>
      </div>
    </header>

    <section class="panel">
      <div class="row">
        <div>
          <div class="name">Add a habit</div>
          <div class="muted">Use an emoji as your icon (e.g., üî•, üíß, üìö). Color is optional.</div>
        </div>
      </div>
      <form class="add" id="addForm">
        <input id="icon" placeholder="üî•" maxlength="3" />
        <input id="name" placeholder="e.g., Read 10 pages" required />
        <input id="color" type="color" value="#6c8bff" class="hidden-mobile" />
        <button>Add habit</button>
      </form>
    </section>

    <section class="grid" id="grid"></section>

    <div class="footer">
      <button id="resetToday" class="ghost">Reset today's completions</button>
      <button id="clearAll" class="danger">Delete ALL data</button>
    </div>

    <p class="tiny">Data is saved only on this device using localStorage. To sync across devices, export/import the backup JSON.</p>
  </div>

  <!-- Menu overlay -->
  <div id="menuOverlay" class="menu-overlay" aria-hidden="true"></div>

  <!-- Slide-in side menu -->
  <aside id="sideMenu" class="side-menu" aria-hidden="true" role="dialog" aria-label="Main Menu">
    <div class="profile">
      <label for="profileUpload" title="Click to change profile picture">
        <img id="profilePic" src="https://via.placeholder.com/160x160.png?text=DP" alt="Profile picture" />
      </label>
      <input id="profileUpload" type="file" accept="image/*" />

      <div id="usernameText" class="username" tabindex="0" title="Click to edit name">Your name</div>
      <input id="usernameEdit" class="username-edit" type="text" />
      <div class="small-muted">Tap avatar to upload. Tap name to edit.</div>
    </div>

    <nav class="menu-buttons" aria-label="Menu options">
      <button id="btnSettings" class="menu-btn">Settings</button>

      <!-- Theme toggle row -->
      <div class="menu-btn" style="align-items:center; justify-content:space-between;">
        <div>
          Dark / Light Theme
        </div>
        <div class="toggle" style="align-items:center;">
          <div id="themeSwitch" class="switch" role="switch" aria-checked="false" title="Toggle theme">
            <div class="knob"></div>
          </div>
        </div>
      </div>

      <button id="btnSupport" class="menu-btn">Customer Support</button>
      <button id="menuLogout" class="menu-btn">Logout</button>
      <button id="btnInvite" class="menu-btn">Invite Friend</button>
    </nav>

    <div class="menu-footer">
      <button id="btnExport" class="menu-btn ghost" style="flex:1">Export</button>
      <button id="btnImport" class="menu-btn ghost" style="flex:1">Import</button>
    </div>
  </aside>

  <script>
    // ---------- Utilities ----------
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    // Profile + menu + theme persistence keys
    const PROFILE_KEY = 'dq_profile_v1';
    const THEME_KEY = 'dq_theme_v1';

    // ---------- Sidebar interactions ----------
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const sideMenu = document.getElementById('sideMenu');
    const menuOverlay = document.getElementById('menuOverlay');

    function openMenu() {
      sideMenu.classList.add('open');
      hamburgerBtn.classList.add('active');
      menuOverlay.classList.add('show');
      sideMenu.setAttribute('aria-hidden', 'false');
      menuOverlay.setAttribute('aria-hidden', 'false');
    }
    function closeMenu() {
      sideMenu.classList.remove('open');
      hamburgerBtn.classList.remove('active');
      menuOverlay.classList.remove('show');
      sideMenu.setAttribute('aria-hidden', 'true');
      menuOverlay.setAttribute('aria-hidden', 'true');
    }

    hamburgerBtn.addEventListener('click', (e) => {
      const open = sideMenu.classList.contains('open');
      if (open) closeMenu(); else openMenu();
    });
    menuOverlay.addEventListener('click', closeMenu);
    // close with ESC
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeMenu();
    });

    // ---------- Profile picture + name ----------
    const profilePic = document.getElementById('profilePic');
    const profileUpload = document.getElementById('profileUpload');
    const usernameText = document.getElementById('usernameText');
    const usernameEdit = document.getElementById('usernameEdit');

    // load saved profile
    function loadProfile() {
      try {
        const raw = localStorage.getItem(PROFILE_KEY);
        if (!raw) return;
        const obj = JSON.parse(raw);
        if (obj.name) usernameText.textContent = obj.name;
        if (obj.img) profilePic.src = obj.img;
      } catch (err) { console.warn('Could not load profile', err); }
    }
    loadProfile();

    profileUpload.addEventListener('change', (e) => {
      const f = e.target.files?.[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = () => {
        profilePic.src = reader.result;
        saveProfile();
      };
      reader.readAsDataURL(f);
    });

    // click username -> edit
    usernameText.addEventListener('click', () => {
      usernameEdit.style.display = 'block';
      usernameEdit.value = usernameText.textContent;
      usernameText.style.display = 'none';
      usernameEdit.focus();
    });
    usernameText.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        usernameText.click();
        e.preventDefault();
      }
    });
    usernameEdit.addEventListener('blur', () => {
      const val = usernameEdit.value.trim() || 'Your name';
      usernameText.textContent = val;
      usernameText.style.display = 'block';
      usernameEdit.style.display = 'none';
      saveProfile();
    });
    usernameEdit.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        usernameEdit.blur();
      }
    });

    function saveProfile() {
      const obj = { name: usernameText.textContent, img: profilePic.src };
      localStorage.setItem(PROFILE_KEY, JSON.stringify(obj));
    }

    // ---------- Theme toggle ----------
    const themeSwitch = document.getElementById('themeSwitch');

    function applyTheme(theme) {
      if (theme === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
        themeSwitch.classList.add('on');
        themeSwitch.setAttribute('aria-checked', 'true');
      } else {
        document.documentElement.removeAttribute('data-theme');
        themeSwitch.classList.remove('on');
        themeSwitch.setAttribute('aria-checked', 'false');
      }
      localStorage.setItem(THEME_KEY, theme || 'dark');
    }

    // load theme from storage
    (function initTheme() {
      const t = localStorage.getItem(THEME_KEY) || 'dark';
      applyTheme(t === 'light' ? 'light' : 'dark');
    })();

    themeSwitch.addEventListener('click', () => {
      const isLight = document.documentElement.getAttribute('data-theme') === 'light';
      applyTheme(isLight ? 'dark' : 'light');
    });

    // ---------- Menu buttons ----------
    $('#btnSettings').addEventListener('click', () => {
      alert('Settings clicked ‚Äî implement settings panel here.');
    });
    $('#btnSupport').addEventListener('click', () => {
      const supportUrl = 'mailto:support@example.com?subject=DailyQuest%20Suppor';
      window.location.href = supportUrl;
    });

    // Invite friend: use Web Share API if possible, otherwise copy text
    $('#btnInvite').addEventListener('click', async () => {
      const shareText = 'Join me on DailyQuest ‚Äî Gamified Habit Tracker! (https://vikashnavik.github.io/gamified/)';
      if (navigator.share) {
        try {
          await navigator.share({ title: 'DailyQuest', text: shareText });
        } catch (err) {
          /* user cancelled or not available */
        }
      } else {
        try {
          await navigator.clipboard.writeText(shareText);
          toast('Invite text copied to clipboard');
        } catch (err) {
          prompt('Copy this invite message:', shareText);
        }
      }
    });

    // export/import quick shortcuts in menu footer
    $('#btnExport').addEventListener('click', () => $('#exportBtn').click());
    $('#btnImport').addEventListener('click', () => $('#importFile').click());

    // ---------- Logout (works with Firebase) ----------
    const menuLogout = document.getElementById('menuLogout');
    menuLogout.addEventListener('click', async () => {
      // window.firebaseSignOut is exported by the firebase module script below.
      if (window.firebaseSignOut) {
        try {
          await window.firebaseSignOut();
        } catch (err) {
          console.error('Logout failed', err);
          alert('Logout failed. Try again.');
        }
      } else {
        // fallback: redirect to auth.html (if you want a forced redirect)
        // or show a message if auth not ready.
        alert('Logout is not ready yet. Please try again in a moment.');
      }
    });

    // ---------- Keep the rest of your app scripts (habits, storage etc.) ----------
    // I will reuse your original app code below; to avoid duplication I place the rest of your code here.
  </script>

  <!-- ========== Existing app logic (modified to append here) ========== -->
  <script>
    // ---------- Utilities ----------
    const $$2 = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    // Reuse small helpers from original script ‚Äî but do not overwrite $
    // ---------- helper date functions ----------
    function todayISO() {
      const d = new Date();
      d.setHours(0,0,0,0);
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const da = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${da}`;
    }
    function addDays(iso, days) {
      const [y,m,d] = iso.split('-').map(Number);
      const dt = new Date(y, m-1, d);
      dt.setDate(dt.getDate()+days);
      return `${dt.getFullYear()}-${String(dt.getMonth()+1).padStart(2,'0')}-${String(dt.getDate()).padStart(2,'0')}`;
    }
    function yesterdayISO() { return addDays(todayISO(), -1); }

    // ---------- Storage ----------
    const KEY = 'habitquest_v1';
    const defaultState = () => ({
      createdAt: todayISO(),
      lastOpenDate: todayISO(),
      xp: 0,
      level: 1,
      badges: [],
      habits: []
    });

    function load() {
      try {
        const raw = localStorage.getItem(KEY);
        return raw ? JSON.parse(raw) : defaultState();
      } catch (e) { console.error(e); return defaultState(); }
    }
    function save() { localStorage.setItem(KEY, JSON.stringify(state)); }

    let state = load();

    // ---------- Daily rollover ----------
    function rolloverIfNewDay() {
      const t = todayISO();
      if (state.lastOpenDate !== t) {
        const yest = yesterdayISO();
        for (const h of state.habits) {
          // break streak if you missed yesterday
          if (h.lastCompletedDate && h.lastCompletedDate !== t && h.lastCompletedDate !== yest) {
            h.streak = 0;
          }
          h.completedToday = false;
        }
        state.lastOpenDate = t;
        save();
      }
    }

    // ---------- XP/Level/Badges ----------
    function addXP(amount) {
      state.xp += amount;
      const before = state.level;
      state.level = Math.floor(state.xp / 100) + 1;
      if (!state.badges.includes('First Step') && state.xp > 0) {
        state.badges.push('First Step');
      }
      if (state.level > before) {
        toast(`Level up! You reached Level ${state.level} ‚ú®`);
      }
    }

    function maybeAwardStreakBadges(habit) {
      if (habit.streak === 7 && !state.badges.includes('7-Day Streak')) state.badges.push('7-Day Streak');
      if (habit.streak === 30 && !state.badges.includes('30-Day Streak')) state.badges.push('30-Day Streak');
    }

    // ---------- Rendering ----------
    const grid = document.getElementById('grid');
    function render() {
      // HUD
      document.getElementById('level').textContent = state.level;
      document.getElementById('xp').textContent = state.xp;
      const toNext = 100 - (state.xp % 100);
      document.getElementById('toNext').textContent = toNext === 100 ? 0 : toNext;
      document.getElementById('xpFill').style.width = `${(state.xp % 100)}%`;
      const badges = state.badges.map(b => `<span class="chip">üèÖ ${b}</span>`).join('');
      document.getElementById('badges').innerHTML =
  badges || "<span class='chip'>No badges yet ‚Äî let's earn some!</span>";

      // Habits
      if (!state.habits.length) {
        grid.innerHTML = `<div class="card">
          <div class="muted">No habits yet. Add one above ‚Äî examples: üßò‚Äç‚ôÇÔ∏è Meditate 5 mins, üíß Drink 8 cups water, üìö Read 10 pages.</div>
        </div>`;
        return;
      }

      grid.innerHTML = state.habits.map(h => {
        const done = !!h.completedToday;
        const btnClass = done ? 'complete done' : 'complete';
        const streak = h.streak || 0;
        const color = h.color || '#121737';
        return `<div class="card" data-id="${h.id}">
          <div class="top">
            <div class="left">
              <div class="icon" style="background:${color}22;border-color:${color}99">${h.icon || 'üéØ'}</div>
              <div>
                <div class="name">${escapeHtml(h.name)}</div>
                <div class="muted">${done ? 'Completed today ‚úì' : 'Not done yet'} ‚Ä¢ <span class="streak">üî• ${streak} day${streak===1?'':'s'} streak</span></div>
              </div>
            </div>
            <div style="display:flex; gap:8px;">
              <button class="${btnClass}">${done ? 'Completed' : '+10 XP'}</button>
              <button class="ghost editBtn">Edit</button>
              <button class="ghost danger delBtn">Delete</button>
            </div>
          </div>
        </div>`;
      }).join('');
    }

    function escapeHtml(str = '') {
  return String(str).replace(/[&<>"']/g, s => ({
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;'
  }[s]));
}

    // ---------- Interactions ----------
    document.getElementById('addForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      if (!name) return;
      const icon = document.getElementById('icon').value.trim() || 'üéØ';
      const color = document.getElementById('color').value || '#6c8bff';
      const habit = { id: crypto.randomUUID(), name, icon, color, streak: 0, lastCompletedDate: null, completedToday: false };
      state.habits.unshift(habit);
      save();
      document.getElementById('name').value = '';
      render();
      toast('Habit added ‚úì');
    });

    grid.addEventListener('click', (e) => {
      const card = e.target.closest('.card');
      if (!card) return;
      const id = card.getAttribute('data-id');
      const habit = state.habits.find(h => h.id === id);
      if (!habit) return;

      if (e.target.classList.contains('complete')) {
        if (habit.completedToday) { toast('Already completed today. Come back tomorrow!'); return; }
        habit.completedToday = true;
        habit.streak = (habit.streak || 0) + 1;
        habit.lastCompletedDate = todayISO();
        addXP(10);
        maybeAwardStreakBadges(habit);
        save();
        render();
        confetti(card);
        return;
      }

      if (e.target.classList.contains('delBtn')) {
        if (!confirm('Delete this habit?')) return;
        state.habits = state.habits.filter(h => h.id !== id);
        save();
        render();
        toast('Habit deleted');
        return;
      }

      if (e.target.classList.contains('editBtn')) {
        const name = prompt('Rename habit:', habit.name) ?? habit.name;
        const icon = prompt('Change icon (emoji):', habit.icon) ?? habit.icon;
        const color = prompt('Change color (hex like #6c8bff):', habit.color) ?? habit.color;
        habit.name = name.trim() || habit.name;
        habit.icon = icon.trim() || habit.icon;
        habit.color = /^#([0-9a-f]{3}){1,2}$/i.test(color) ? color : habit.color;
        save();
        render();
        toast('Habit updated');
      }
    });

    document.getElementById('resetToday').addEventListener('click', () => {
      if (!confirm("Reset today's completions for all habits?")) return;
for (const h of state.habits) h.completedToday = false;
      save();
      render();
      toast("Today's completions reset");
    });

    document.getElementById('clearAll').addEventListener('click', () => {
      if (!confirm('This will DELETE all your habits and progress. Continue?')) return;
      state = defaultState();
      save();
      render();
      toast('All data cleared');
    });

    // Export/Import
    document.getElementById('exportBtn').addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'habitquest-backup.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    document.getElementById('importFile').addEventListener('change', (e) => {
      const file = e.target.files?.[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const json = JSON.parse(reader.result);
          if (!json || typeof json !== 'object' || !Array.isArray(json.habits)) throw new Error('Invalid file');
          state = json; save(); render(); toast('Backup imported ‚úì');
        } catch (err) { alert('Could not import this file.'); }
      };
      reader.readAsText(file);
    });

    // ---------- Tiny UI helpers ----------
    function toast(msg) {
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.position = 'fixed';
      t.style.bottom = '16px';
      t.style.left = '50%';
      t.style.transform = 'translateX(-50%)';
      t.style.background = '#111428';
      t.style.border = '1px solid #2b3154';
      t.style.padding = '10px 14px';
      t.style.borderRadius = '999px';
      t.style.fontSize = '13px';
      t.style.color = 'var(--text)';
      t.style.boxShadow = '0 10px 30px rgba(0,0,0,.35)';
      document.body.appendChild(t);
      setTimeout(()=> t.remove(), 1800);
    }

    function confetti(el) {
      const rect = el.getBoundingClientRect();
      for (let i=0; i<18; i++) {
        const p = document.createElement('div');
        p.style.position = 'fixed';
        p.style.left = (rect.left + rect.width/2) + 'px';
        p.style.top = (rect.top + 10) + 'px';
        p.style.width = '6px'; p.style.height = '10px';
        p.style.borderRadius = '2px';
        p.style.background = `hsl(${Math.random()*360}, 90%, 60%)`;
        p.style.opacity = '0.9';
        p.style.transform = `translate(-50%, -50%) rotate(${Math.random()*360}deg)`;
        document.body.appendChild(p);
        const dx = (Math.random()*2-1) * 120; const dy = 120 + Math.random()*80; const rot = (Math.random()*720-360);
        p.animate([
          { transform: `translate(0,0) rotate(0deg)`, opacity: 1 },
          { transform: `translate(${dx}px, ${dy}px) rotate(${rot}deg)`, opacity: 0 }
        ], { duration: 900 + Math.random()*400, easing: 'cubic-bezier(.22,.68,0,1.71)' });
        setTimeout(()=>p.remove(), 1300);
      }
    }

    // ---------- Init ----------
    rolloverIfNewDay();
    render();

    // load profile if any (call the function defined earlier)
    try { if (typeof loadProfile === 'function') loadProfile(); } catch(e){}

  </script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAxKkJqDUwXYkNpbmwsiVhh9m2SSdfordI",
  authDomain: "gamified-aut.firebaseapp.com",
  projectId: "gamified-aut",
  storageBucket: "gamified-aut.appspot.com",
  messagingSenderId: "379085065815",
  appId: "1:379085065815:web:f65123e48721b0967c9d12"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// ‚úÖ Protect index.html
onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.replace("auth.html");
  }
});

// ‚úÖ Logout function
window.firebaseSignOut = async () => {
  await signOut(auth);
  window.location.replace("auth.html");
};
</script>


</body>
</html>
